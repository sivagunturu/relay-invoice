{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///Users/sivagunturu/Documents/relay-invoice/src/lib/supabase/server.ts"],"sourcesContent":["import { createServerClient } from '@supabase/ssr';\nimport { createClient as createSupabaseClient } from '@supabase/supabase-js';\nimport { cookies } from 'next/headers';\n\nexport async function createClient() {\n  const cookieStore = await cookies();\n\n  return createServerClient(\n    process.env.NEXT_PUBLIC_SUPABASE_URL!,\n    process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!,\n    {\n      cookies: {\n        getAll() {\n          return cookieStore.getAll();\n        },\n        setAll(cookiesToSet) {\n          try {\n            cookiesToSet.forEach(({ name, value, options }) =>\n              cookieStore.set(name, value, options)\n            );\n          } catch {\n            // The `setAll` method was called from a Server Component.\n            // This can be ignored if you have middleware refreshing\n            // user sessions.\n          }\n        },\n      },\n    }\n  );\n}\n\n// Service client bypasses RLS - use ONLY on server\nexport async function createServiceClient() {\n  return createSupabaseClient(\n    process.env.NEXT_PUBLIC_SUPABASE_URL!,\n    process.env.SUPABASE_SERVICE_ROLE_KEY!,\n    {\n      auth: {\n        autoRefreshToken: false,\n        persistSession: false,\n      },\n    }\n  );\n}\n"],"names":[],"mappings":";;;;;;AAAA;AAAA;AACA;AACA;;;;AAEO,eAAe;IACpB,MAAM,cAAc,MAAM,IAAA,4IAAO;IAEjC,OAAO,IAAA,iMAAkB,sUAGvB;QACE,SAAS;YACP;gBACE,OAAO,YAAY,MAAM;YAC3B;YACA,QAAO,YAAY;gBACjB,IAAI;oBACF,aAAa,OAAO,CAAC,CAAC,EAAE,IAAI,EAAE,KAAK,EAAE,OAAO,EAAE,GAC5C,YAAY,GAAG,CAAC,MAAM,OAAO;gBAEjC,EAAE,OAAM;gBACN,0DAA0D;gBAC1D,wDAAwD;gBACxD,iBAAiB;gBACnB;YACF;QACF;IACF;AAEJ;AAGO,eAAe;IACpB,OAAO,IAAA,gMAAoB,gFAEzB,QAAQ,GAAG,CAAC,yBAAyB,EACrC;QACE,MAAM;YACJ,kBAAkB;YAClB,gBAAgB;QAClB;IACF;AAEJ"}},
    {"offset": {"line": 96, "column": 0}, "map": {"version":3,"sources":["file:///Users/sivagunturu/Documents/relay-invoice/src/lib/validations/schemas.ts"],"sourcesContent":["import { z } from 'zod';\n\nexport const signUpSchema = z.object({\n  email: z.string().email(),\n  password: z.string().min(8),\n  companyName: z.string().min(1),\n});\n\nexport const loginSchema = z.object({\n  email: z.string().email(),\n  password: z.string().min(1),\n});\n\nexport const clientSchema = z.object({\n  name: z.string().min(1),\n  addressLine1: z.string().optional(),\n  addressLine2: z.string().optional(),\n  addressLine3: z.string().optional(),\n  email: z.string().email().optional().or(z.literal('')),\n  terms: z.string().optional(),\n  currency: z.string().optional(),\n});\n\nexport const consultantSchema = z.object({\n  name: z.string().min(1),\n  defaultRate: z.coerce.number().min(0),\n  unitType: z.string().default('hour'),\n  defaultDescription: z.string().optional(),\n});\n\nexport const settingsSchema = z.object({\n  companyName: z.string().min(1),\n  addressLine1: z.string().optional(),\n  addressLine2: z.string().optional(),\n  addressLine3: z.string().optional(),\n  email: z.string().email().optional().or(z.literal('')),\n  phone: z.string().optional(),\n  defaultTerms: z.string(),\n  defaultCurrency: z.string(),\n  invoicePrefix: z.string().min(1),\n  footerNote: z.string().optional(),\n});\n"],"names":[],"mappings":";;;;;;;;;;;;AAAA;;AAEO,MAAM,eAAe,yKAAC,CAAC,MAAM,CAAC;IACnC,OAAO,yKAAC,CAAC,MAAM,GAAG,KAAK;IACvB,UAAU,yKAAC,CAAC,MAAM,GAAG,GAAG,CAAC;IACzB,aAAa,yKAAC,CAAC,MAAM,GAAG,GAAG,CAAC;AAC9B;AAEO,MAAM,cAAc,yKAAC,CAAC,MAAM,CAAC;IAClC,OAAO,yKAAC,CAAC,MAAM,GAAG,KAAK;IACvB,UAAU,yKAAC,CAAC,MAAM,GAAG,GAAG,CAAC;AAC3B;AAEO,MAAM,eAAe,yKAAC,CAAC,MAAM,CAAC;IACnC,MAAM,yKAAC,CAAC,MAAM,GAAG,GAAG,CAAC;IACrB,cAAc,yKAAC,CAAC,MAAM,GAAG,QAAQ;IACjC,cAAc,yKAAC,CAAC,MAAM,GAAG,QAAQ;IACjC,cAAc,yKAAC,CAAC,MAAM,GAAG,QAAQ;IACjC,OAAO,yKAAC,CAAC,MAAM,GAAG,KAAK,GAAG,QAAQ,GAAG,EAAE,CAAC,yKAAC,CAAC,OAAO,CAAC;IAClD,OAAO,yKAAC,CAAC,MAAM,GAAG,QAAQ;IAC1B,UAAU,yKAAC,CAAC,MAAM,GAAG,QAAQ;AAC/B;AAEO,MAAM,mBAAmB,yKAAC,CAAC,MAAM,CAAC;IACvC,MAAM,yKAAC,CAAC,MAAM,GAAG,GAAG,CAAC;IACrB,aAAa,yKAAC,CAAC,MAAM,CAAC,MAAM,GAAG,GAAG,CAAC;IACnC,UAAU,yKAAC,CAAC,MAAM,GAAG,OAAO,CAAC;IAC7B,oBAAoB,yKAAC,CAAC,MAAM,GAAG,QAAQ;AACzC;AAEO,MAAM,iBAAiB,yKAAC,CAAC,MAAM,CAAC;IACrC,aAAa,yKAAC,CAAC,MAAM,GAAG,GAAG,CAAC;IAC5B,cAAc,yKAAC,CAAC,MAAM,GAAG,QAAQ;IACjC,cAAc,yKAAC,CAAC,MAAM,GAAG,QAAQ;IACjC,cAAc,yKAAC,CAAC,MAAM,GAAG,QAAQ;IACjC,OAAO,yKAAC,CAAC,MAAM,GAAG,KAAK,GAAG,QAAQ,GAAG,EAAE,CAAC,yKAAC,CAAC,OAAO,CAAC;IAClD,OAAO,yKAAC,CAAC,MAAM,GAAG,QAAQ;IAC1B,cAAc,yKAAC,CAAC,MAAM;IACtB,iBAAiB,yKAAC,CAAC,MAAM;IACzB,eAAe,yKAAC,CAAC,MAAM,GAAG,GAAG,CAAC;IAC9B,YAAY,yKAAC,CAAC,MAAM,GAAG,QAAQ;AACjC"}},
    {"offset": {"line": 150, "column": 0}, "map": {"version":3,"sources":["file:///Users/sivagunturu/Documents/relay-invoice/src/lib/actions/auth.ts"],"sourcesContent":["'use server';\n\nimport { createClient as createSupabaseClient } from '@/lib/supabase/server';\nimport { redirect } from 'next/navigation';\nimport { signUpSchema, loginSchema } from '../validations/schemas';\n\nexport async function signUp(formData: FormData) {\n  const supabase = await createSupabaseClient();\n\n  const data = signUpSchema.parse({\n    email: formData.get('email'),\n    password: formData.get('password'),\n    companyName: formData.get('companyName'),\n  });\n\n  const { data: authData, error } = await supabase.auth.signUp({\n    email: data.email,\n    password: data.password,\n  });\n\n  if (error) {\n    return { error: error.message };\n  }\n\n  if (authData.user) {\n    // Create organization\n    const { data: org, error: orgError } = await supabase\n      .from('organizations')\n      .insert({ name: data.companyName })\n      .select()\n      .single();\n\n    if (orgError || !org) {\n      return { error: 'Failed to create organization' };\n    }\n\n    // Add user as owner\n    await supabase.from('org_members').insert({\n      org_id: org.id,\n      user_id: authData.user.id,\n      role: 'owner',\n      status: 'active',\n    });\n\n    // Create org settings\n    await supabase.from('org_settings').insert({\n      org_id: org.id,\n      company_name: data.companyName,\n      default_terms: 'Net 60',\n      default_currency: 'USD',\n      invoice_prefix: 'INV',\n      invoice_counter: 0,\n    });\n  }\n\n  redirect('/dashboard');\n}\n\nexport async function login(formData: FormData) {\n  const supabase = await createSupabaseClient();\n\n  const data = loginSchema.parse({\n    email: formData.get('email'),\n    password: formData.get('password'),\n  });\n\n  const { error } = await supabase.auth.signInWithPassword(data);\n\n  if (error) {\n    return { error: error.message };\n  }\n\n  redirect('/dashboard');\n}\n\nexport async function logout() {\n  const supabase = await createSupabaseClient();\n  await supabase.auth.signOut();\n  redirect('/login');\n}\n\nexport async function getUser() {\n  const supabase = await createSupabaseClient();\n  const { data: { user } } = await supabase.auth.getUser();\n  return user;\n}\n"],"names":[],"mappings":";;;;;;;;;;;AAEA;AACA;AAAA;AACA;;;;;;AAEO,eAAe,OAAO,QAAkB;IAC7C,MAAM,WAAW,MAAM,IAAA,kJAAoB;IAE3C,MAAM,OAAO,sJAAY,CAAC,KAAK,CAAC;QAC9B,OAAO,SAAS,GAAG,CAAC;QACpB,UAAU,SAAS,GAAG,CAAC;QACvB,aAAa,SAAS,GAAG,CAAC;IAC5B;IAEA,MAAM,EAAE,MAAM,QAAQ,EAAE,KAAK,EAAE,GAAG,MAAM,SAAS,IAAI,CAAC,MAAM,CAAC;QAC3D,OAAO,KAAK,KAAK;QACjB,UAAU,KAAK,QAAQ;IACzB;IAEA,IAAI,OAAO;QACT,OAAO;YAAE,OAAO,MAAM,OAAO;QAAC;IAChC;IAEA,IAAI,SAAS,IAAI,EAAE;QACjB,sBAAsB;QACtB,MAAM,EAAE,MAAM,GAAG,EAAE,OAAO,QAAQ,EAAE,GAAG,MAAM,SAC1C,IAAI,CAAC,iBACL,MAAM,CAAC;YAAE,MAAM,KAAK,WAAW;QAAC,GAChC,MAAM,GACN,MAAM;QAET,IAAI,YAAY,CAAC,KAAK;YACpB,OAAO;gBAAE,OAAO;YAAgC;QAClD;QAEA,oBAAoB;QACpB,MAAM,SAAS,IAAI,CAAC,eAAe,MAAM,CAAC;YACxC,QAAQ,IAAI,EAAE;YACd,SAAS,SAAS,IAAI,CAAC,EAAE;YACzB,MAAM;YACN,QAAQ;QACV;QAEA,sBAAsB;QACtB,MAAM,SAAS,IAAI,CAAC,gBAAgB,MAAM,CAAC;YACzC,QAAQ,IAAI,EAAE;YACd,cAAc,KAAK,WAAW;YAC9B,eAAe;YACf,kBAAkB;YAClB,gBAAgB;YAChB,iBAAiB;QACnB;IACF;IAEA,IAAA,mMAAQ,EAAC;AACX;AAEO,eAAe,MAAM,QAAkB;IAC5C,MAAM,WAAW,MAAM,IAAA,kJAAoB;IAE3C,MAAM,OAAO,qJAAW,CAAC,KAAK,CAAC;QAC7B,OAAO,SAAS,GAAG,CAAC;QACpB,UAAU,SAAS,GAAG,CAAC;IACzB;IAEA,MAAM,EAAE,KAAK,EAAE,GAAG,MAAM,SAAS,IAAI,CAAC,kBAAkB,CAAC;IAEzD,IAAI,OAAO;QACT,OAAO;YAAE,OAAO,MAAM,OAAO;QAAC;IAChC;IAEA,IAAA,mMAAQ,EAAC;AACX;AAEO,eAAe;IACpB,MAAM,WAAW,MAAM,IAAA,kJAAoB;IAC3C,MAAM,SAAS,IAAI,CAAC,OAAO;IAC3B,IAAA,mMAAQ,EAAC;AACX;AAEO,eAAe;IACpB,MAAM,WAAW,MAAM,IAAA,kJAAoB;IAC3C,MAAM,EAAE,MAAM,EAAE,IAAI,EAAE,EAAE,GAAG,MAAM,SAAS,IAAI,CAAC,OAAO;IACtD,OAAO;AACT;;;IA/EsB;IAoDA;IAiBA;IAMA;;AA3EA,iPAAA;AAoDA,iPAAA;AAiBA,iPAAA;AAMA,iPAAA"}},
    {"offset": {"line": 254, "column": 0}, "map": {"version":3,"sources":["file:///Users/sivagunturu/Documents/relay-invoice/src/lib/actions/organizations.ts"],"sourcesContent":["'use server';\n\nimport { createClient as createSupabaseClient } from '@/lib/supabase/server';\nimport { getUser } from './auth';\n\nexport async function getUserOrganization() {\n  const supabase = await createSupabaseClient();\n  const user = await getUser();\n\n  if (!user) {\n    console.log('No user found');\n    return null;\n  }\n\n  console.log('Fetching org for user:', user.id);\n\n  // Step 1: Get the org_member record\n  const { data: membership, error: memberError } = await supabase\n    .from('org_members')\n    .select('id, role, status, org_id')\n    .eq('user_id', user.id)\n    .eq('status', 'active')\n    .single();\n\n  if (memberError || !membership) {\n    console.error('Error fetching membership:', memberError);\n    return null;\n  }\n\n  console.log('Found membership:', membership);\n\n  // Step 2: Get the organization\n  const { data: org, error: orgError } = await supabase\n    .from('organizations')\n    .select('id, name, created_at')\n    .eq('id', membership.org_id)\n    .single();\n\n  if (orgError || !org) {\n    console.error('Error fetching organization:', orgError);\n    return null;\n  }\n\n  console.log('Found organization:', org);\n\n  return {\n    id: org.id,\n    name: org.name,\n    role: membership.role,\n  };\n}\n"],"names":[],"mappings":";;;;;AAEA;AACA;;;;;AAEO,eAAe;IACpB,MAAM,WAAW,MAAM,IAAA,kJAAoB;IAC3C,MAAM,OAAO,MAAM,IAAA,0IAAO;IAE1B,IAAI,CAAC,MAAM;QACT,QAAQ,GAAG,CAAC;QACZ,OAAO;IACT;IAEA,QAAQ,GAAG,CAAC,0BAA0B,KAAK,EAAE;IAE7C,oCAAoC;IACpC,MAAM,EAAE,MAAM,UAAU,EAAE,OAAO,WAAW,EAAE,GAAG,MAAM,SACpD,IAAI,CAAC,eACL,MAAM,CAAC,4BACP,EAAE,CAAC,WAAW,KAAK,EAAE,EACrB,EAAE,CAAC,UAAU,UACb,MAAM;IAET,IAAI,eAAe,CAAC,YAAY;QAC9B,QAAQ,KAAK,CAAC,8BAA8B;QAC5C,OAAO;IACT;IAEA,QAAQ,GAAG,CAAC,qBAAqB;IAEjC,+BAA+B;IAC/B,MAAM,EAAE,MAAM,GAAG,EAAE,OAAO,QAAQ,EAAE,GAAG,MAAM,SAC1C,IAAI,CAAC,iBACL,MAAM,CAAC,wBACP,EAAE,CAAC,MAAM,WAAW,MAAM,EAC1B,MAAM;IAET,IAAI,YAAY,CAAC,KAAK;QACpB,QAAQ,KAAK,CAAC,gCAAgC;QAC9C,OAAO;IACT;IAEA,QAAQ,GAAG,CAAC,uBAAuB;IAEnC,OAAO;QACL,IAAI,IAAI,EAAE;QACV,MAAM,IAAI,IAAI;QACd,MAAM,WAAW,IAAI;IACvB;AACF;;;IA7CsB;;AAAA,iPAAA"}},
    {"offset": {"line": 302, "column": 0}, "map": {"version":3,"sources":["file:///Users/sivagunturu/Documents/relay-invoice/src/lib/utils.ts"],"sourcesContent":["import { formatInTimeZone } from 'date-fns-tz';\nimport { addMonths, addDays } from 'date-fns';\n\nexport const TIMEZONE = 'America/Chicago';\n\nexport function formatCurrency(amount: number | string): string {\n  const num = typeof amount === 'string' ? parseFloat(amount) : amount;\n  return new Intl.NumberFormat('en-US', {\n    style: 'currency',\n    currency: 'USD',\n  }).format(num);\n}\n\nexport function formatDate(date: Date | string, format = 'MMM dd, yyyy'): string {\n  const d = typeof date === 'string' ? new Date(date) : date;\n  return formatInTimeZone(d, TIMEZONE, format);\n}\n\nexport function getNextMonthStart(dayOfMonth: number): Date {\n  const now = new Date();\n  const next = addMonths(now, 1);\n  next.setDate(dayOfMonth);\n  next.setHours(0, 0, 0, 0);\n  return next;\n}\n\nexport function calculateDueDate(issueDate: Date, terms: string): Date {\n  const match = terms.match(/Net (\\d+)/i);\n  const days = match ? parseInt(match[1]) : 30;\n  return addDays(issueDate, days);\n}\n"],"names":[],"mappings":";;;;;;;;;;;;AAAA;AAAA;AACA;AAAA;;;AAEO,MAAM,WAAW;AAEjB,SAAS,eAAe,MAAuB;IACpD,MAAM,MAAM,OAAO,WAAW,WAAW,WAAW,UAAU;IAC9D,OAAO,IAAI,KAAK,YAAY,CAAC,SAAS;QACpC,OAAO;QACP,UAAU;IACZ,GAAG,MAAM,CAAC;AACZ;AAEO,SAAS,WAAW,IAAmB,EAAE,SAAS,cAAc;IACrE,MAAM,IAAI,OAAO,SAAS,WAAW,IAAI,KAAK,QAAQ;IACtD,OAAO,IAAA,mMAAgB,EAAC,GAAG,UAAU;AACvC;AAEO,SAAS,kBAAkB,UAAkB;IAClD,MAAM,MAAM,IAAI;IAChB,MAAM,OAAO,IAAA,uJAAS,EAAC,KAAK;IAC5B,KAAK,OAAO,CAAC;IACb,KAAK,QAAQ,CAAC,GAAG,GAAG,GAAG;IACvB,OAAO;AACT;AAEO,SAAS,iBAAiB,SAAe,EAAE,KAAa;IAC7D,MAAM,QAAQ,MAAM,KAAK,CAAC;IAC1B,MAAM,OAAO,QAAQ,SAAS,KAAK,CAAC,EAAE,IAAI;IAC1C,OAAO,IAAA,mJAAO,EAAC,WAAW;AAC5B"}},
    {"offset": {"line": 348, "column": 0}, "map": {"version":3,"sources":["file:///Users/sivagunturu/Documents/relay-invoice/src/lib/actions/invoices.ts"],"sourcesContent":["'use server';\n\nimport { createClient as createSupabaseClient, createServiceClient } from '@/lib/supabase/server';\nimport { getUserOrganization } from './organizations';\nimport { getUser } from './auth';\nimport { revalidatePath } from 'next/cache';\nimport { redirect } from 'next/navigation';\nimport { calculateDueDate } from '../utils';\n\nexport async function getInvoices() {\n  const supabase = await createSupabaseClient();\n  const org = await getUserOrganization();\n\n  if (!org) throw new Error('No organization found');\n\n  const { data, error } = await supabase\n    .from('invoices')\n    .select(`\n      *,\n      clients (id, name)\n    `)\n    .eq('org_id', org.id)\n    .order('created_at', { ascending: false });\n\n  if (error) throw new Error(error.message);\n  return data;\n}\n\nexport async function getInvoice(id: string) {\n  const supabase = await createSupabaseClient();\n  const org = await getUserOrganization();\n\n  if (!org) throw new Error('No organization found');\n\n  const { data, error } = await supabase\n    .from('invoices')\n    .select(`\n      *,\n      clients (*),\n      invoice_items (*)\n    `)\n    .eq('id', id)\n    .eq('org_id', org.id)\n    .single();\n\n  if (error) throw new Error(error.message);\n  return data;\n}\n\nexport async function createInvoiceFromTemplate(templateId: string, month: string) {\n  const supabase = await createSupabaseClient();\n  const org = await getUserOrganization();\n  const user = await getUser();\n\n  if (!org || !user) throw new Error('Authentication required');\n\n  // Get template with items\n  const { data: template } = await supabase\n    .from('invoice_templates')\n    .select(`\n      *,\n      clients (*),\n      invoice_template_items (*)\n    `)\n    .eq('id', templateId)\n    .eq('org_id', org.id)\n    .single();\n\n  if (!template) throw new Error('Template not found');\n\n  // Get org settings for invoice numbering\n  const { data: settings } = await supabase\n    .from('org_settings')\n    .select('*')\n    .eq('org_id', org.id)\n    .single();\n\n  if (!settings) throw new Error('Settings not found');\n\n  // Generate invoice number using database function\n  const { data: invoiceNumberResult } = await supabase\n    .rpc('generate_invoice_number', {\n      p_org_id: org.id,\n      p_month: month,\n    });\n\n  const invoiceNumber = invoiceNumberResult as string;\n\n  // Calculate dates\n  const issueDate = new Date();\n  const dueDate = calculateDueDate(issueDate, settings.default_terms);\n\n  // Create invoice\n  const { data: invoice, error: invoiceError } = await supabase\n    .from('invoices')\n    .insert({\n      org_id: org.id,\n      client_id: template.client_id,\n      template_id: templateId,\n      invoice_number: invoiceNumber,\n      issue_date: issueDate.toISOString().split('T')[0],\n      due_date: dueDate.toISOString().split('T')[0],\n      month,\n      status: 'draft',\n      terms: settings.default_terms,\n      currency: settings.default_currency,\n      payment_instructions: settings.payment_instructions,\n      compliance_text: settings.compliance_text,\n    })\n    .select()\n    .single();\n\n  if (invoiceError) throw new Error(invoiceError.message);\n\n  // Create invoice items from template\n  if (template.invoice_template_items && template.invoice_template_items.length > 0) {\n    const items = template.invoice_template_items.map((item: any, index: number) => ({\n      org_id: org.id,\n      invoice_id: invoice.id,\n      description: item.description,\n      qty: item.qty_default,\n      rate: item.rate_default,\n      amount: parseFloat(item.qty_default) * parseFloat(item.rate_default),\n      sort_order: index,\n    }));\n\n    await supabase.from('invoice_items').insert(items);\n  }\n\n  revalidatePath('/invoices');\n  redirect(`/invoices/${invoice.id}/edit`);\n}\n\nexport async function createInvoice(formData: FormData) {\n  const supabase = await createSupabaseClient();\n  const org = await getUserOrganization();\n\n  if (!org) throw new Error('No organization found');\n\n  const clientId = formData.get('clientId') as string;\n  const issueDate = formData.get('issueDate') as string;\n  const month = formData.get('month') as string;\n  const terms = formData.get('terms') as string;\n  const currency = formData.get('currency') as string;\n\n  // Get org settings\n  const { data: settings } = await supabase\n    .from('org_settings')\n    .select('*')\n    .eq('org_id', org.id)\n    .single();\n\n  if (!settings) throw new Error('Settings not found');\n\n  // Generate invoice number\n  const { data: invoiceNumberResult } = await supabase\n    .rpc('generate_invoice_number', {\n      p_org_id: org.id,\n      p_month: month,\n    });\n\n  const invoiceNumber = invoiceNumberResult as string;\n\n  const dueDate = calculateDueDate(new Date(issueDate), terms);\n\n  const { data: invoice, error } = await supabase\n    .from('invoices')\n    .insert({\n      org_id: org.id,\n      client_id: clientId,\n      invoice_number: invoiceNumber,\n      issue_date: issueDate,\n      due_date: dueDate.toISOString().split('T')[0],\n      month,\n      status: 'draft',\n      terms,\n      currency,\n      payment_instructions: settings.payment_instructions,\n      compliance_text: settings.compliance_text,\n    })\n    .select()\n    .single();\n\n  if (error) throw new Error(error.message);\n\n  revalidatePath('/invoices');\n  redirect(`/invoices/${invoice.id}/edit`);\n}\n\nexport async function updateInvoiceItems(invoiceId: string, itemsJson: string) {\n  const supabase = await createSupabaseClient();\n  const org = await getUserOrganization();\n\n  if (!org) throw new Error('No organization found');\n\n  const items = JSON.parse(itemsJson);\n\n  // Calculate totals\n  let subtotal = 0;\n  items.forEach((item: any) => {\n    subtotal += parseFloat(item.qty) * parseFloat(item.rate);\n  });\n\n  const tax = 0; // Phase 1: no tax\n  const total = subtotal + tax;\n\n  // Delete existing items\n  await supabase\n    .from('invoice_items')\n    .delete()\n    .eq('invoice_id', invoiceId);\n\n  // Insert new items\n  const itemsToInsert = items.map((item: any, index: number) => ({\n    org_id: org.id,\n    invoice_id: invoiceId,\n    description: item.description,\n    qty: item.qty,\n    rate: item.rate,\n    amount: parseFloat(item.qty) * parseFloat(item.rate),\n    sort_order: index,\n  }));\n\n  await supabase.from('invoice_items').insert(itemsToInsert);\n\n  // Update invoice totals\n  await supabase\n    .from('invoices')\n    .update({\n      subtotal: subtotal.toString(),\n      tax: tax.toString(),\n      total: total.toString(),\n    })\n    .eq('id', invoiceId)\n    .eq('org_id', org.id);\n\n  revalidatePath(`/invoices/${invoiceId}`);\n  return { success: true };\n}\n\nexport async function generateInvoicePDF(invoiceId: string) {\n  const supabase = await createServiceClient();\n  const org = await getUserOrganization();\n  const user = await getUser();\n\n  if (!org || !user) throw new Error('Authentication required');\n\n  // Create job for PDF generation (using correct column names)\n  const { data: job, error } = await supabase\n    .from('jobs')\n    .insert({\n      org_id: org.id,\n      job_type: 'generate_pdf',  // Changed from 'type'\n      metadata: {                  // Changed from 'payload_json'\n        invoice_id: invoiceId,\n        user_id: user.id,\n      },\n      status: 'queued',\n      attempts: 0,\n    })\n    .select()\n    .single();\n\n  if (error) throw new Error(error.message);\n\n  // Create audit log\n  await supabase.from('audit_log').insert({\n    org_id: org.id,\n    user_id: user.id,\n    action: 'generate_pdf_queued',\n    entity_type: 'invoice',\n    entity_id: invoiceId,\n    metadata: { job_id: job.id },\n  });\n\n  return { success: true, jobId: job.id };\n}\n\nexport async function deleteInvoice(id: string) {\n  const supabase = await createSupabaseClient();\n  const org = await getUserOrganization();\n\n  if (!org) throw new Error('No organization found');\n\n  const { error } = await supabase\n    .from('invoices')\n    .delete()\n    .eq('id', id)\n    .eq('org_id', org.id);\n\n  if (error) throw new Error(error.message);\n\n  revalidatePath('/invoices');\n  return { success: true };\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 598, "column": 0}, "map": {"version":3,"sources":["file:///Users/sivagunturu/Documents/relay-invoice/src/app/api/invoices/%5Bid%5D/generate-pdf/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server';\nimport { generateInvoicePDF } from '@/lib/actions/invoices';\n\nexport async function POST(\n  request: NextRequest,\n  { params }: { params: Promise<{ id: string }> }\n) {\n  try {\n    const { id } = await params;\n    console.log('Generating PDF for invoice:', id);\n    const result = await generateInvoicePDF(id);\n    console.log('PDF generation result:', result);\n    return NextResponse.json(result);\n  } catch (error: any) {\n    console.error('PDF generation error:', error);\n    return NextResponse.json(\n      { error: error.message || 'Unknown error' },\n      { status: 500 }\n    );\n  }\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAEO,eAAe,KACpB,OAAoB,EACpB,EAAE,MAAM,EAAuC;IAE/C,IAAI;QACF,MAAM,EAAE,EAAE,EAAE,GAAG,MAAM;QACrB,QAAQ,GAAG,CAAC,+BAA+B;QAC3C,MAAM,SAAS,MAAM,IAAA,yJAAkB,EAAC;QACxC,QAAQ,GAAG,CAAC,0BAA0B;QACtC,OAAO,gJAAY,CAAC,IAAI,CAAC;IAC3B,EAAE,OAAO,OAAY;QACnB,QAAQ,KAAK,CAAC,yBAAyB;QACvC,OAAO,gJAAY,CAAC,IAAI,CACtB;YAAE,OAAO,MAAM,OAAO,IAAI;QAAgB,GAC1C;YAAE,QAAQ;QAAI;IAElB;AACF"}}]
}